<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<main>
  <h1 class="mb-3"> Lead Details </h1>
  <section id="lead-details" class="container-sm">
    <div class="card mb-3 ">
      <h4 class="card-header">Lead Information - <%= lead.name %> </h4>
      <div class="card-body">
        <% if (lead.owner.equals(user?.profile.id)) { %>   
          <div class="d-flex justify-content-start mb-3">
            <form action="/leads/<%= lead._id %>/edit" method="GET">
              <button type="submit" class="btn btn-primary ms-3"> Edit Lead </button>
            </form>
            <form action="/leads/<%= lead._id %>?_method=DELETE" method="POST">
              <button type="submit" class="btn btn-danger ms-3"> Delete Lead </button>
            </form>
          </div>
        <% } %>
        <h5 class="card-title"> Status </h5>
        <p class="card-text"> <%= lead.status %> </p>
        <h5 class="card-title"> Value </h5>
        <p class="card-text"> $ <%= lead.value %> </p>
        <h5 class="card-title"> Assigned Owner </h5>
        <p class="card-text"> <%= lead.owner.name %> </p>
        <h5 class="card-title"> Lead Name </h5>
        <p class="card-text"> <%= lead.name %> </p>
        <h5 class="card-title"> Description </h5>
        <% if (!lead.description) { %>
          <p class="card-text"> no description provided </p>
        <% } else { %>
          <p class="card-text"> <%= lead.description %> </p>
        <% } %>
      </div>
    </div>
  </section>
  <section id="lead-details" class="container-sm">
    <div class="card mb-3 ">
      <h4 class="card-header">Comments</h4>
      <div class="card-body">
          <% lead.comments.forEach(comment => { %>
            <div class="mb-3 d-flex justify-content-start">
              <div>
                <img src="<%= comment.author.avatar %>" alt="" class="small-round-avatar">
              </div>
              <div class="ms-3">
                <p><%= comment.content %></p>
                <p>Posted by - <%= comment.author.name %> - <%= comment.createdAt %></p> 
              </div>
            </div>
          <% }) %>
        <form action="/leads/<%= lead._id %>/comments" method="POST" class="mb-3">
          <textarea name="content" id="" cols="60" rows="3" required></textarea>
          <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-primary mt-3"> Add Comment </button>
          </div>
        </form>
      </div>
    </div>
  </section>

</main>

<%- include('../partials/footer') %>